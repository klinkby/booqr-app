server.document-root = "/app"
server.bind = "/var/run/lighttpd/sock"
server.username = "web"
server.groupname = "web"
server.errorlog = "/proc/self/fd/2"
server.pid-file = "/tmp/lighttpd.pid"
server.follow-symlink = "disable"
server.modules = ( "mod_rewrite", "mod_setenv" )

# SPA fallback: serve index.html for all routes
url.rewrite-once = (
  "^/_app/.*$" => "$0",
  "^/.*\.(js|css|svg|png|jpg|jpeg|ico|json|txt)$" => "$0",
  "^/.*$" => "/index.html"
)

index-file.names = ( "index.html" )

$HTTP["url"] =~ "^/index\.html$" {
  setenv.add-response-header = (
    "Cache-Control" => "public, max-age=86400, s-maxage=60",
    "Link" => "<https://www.booqr.dk/>; rel=\"canonical\""
  )
}

$HTTP["url"] =~ "^/robots.txt$" {
  setenv.add-response-header = (
    "Cache-Control" => "public, max-age=86400"
  )
}

$HTTP["url"] =~ "^/_app/immutable/.*$" {
  setenv.add-response-header = (
    "Cache-Control" => "public, max-age=31536000, immutable"
  )
}

mimetype.assign = (
    ".html" => "text/html",
    ".css"  => "text/css",
    ".js"   => "application/javascript",
    ".json" => "application/json",
    ".svg"  => "image/svg+xml",
    ".png"  => "image/png",
    ".jpg"  => "image/jpeg",
    ".jpeg"  => "image/jpeg",
    ".ico"  => "image/x-icon",
    ".txt"  => "text/plain"
)
